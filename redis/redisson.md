### redisson의 락 pub-sub 구조의 오해

몇몇 포스팅글을 읽어보면 redisson에서 분산락을 시도하면, 스핀락 구조가 아닌 pub-sub구조라서 더 효율적이다(?) 라는 글을 봤다.

단순 pub-sub을 사용하는게 왜 효율적이라는게 이해가 안갔는데, 아래 포스팅을 읽어보니 금방알 수 있었다.


A, B가 동시에 요청하고, B가 대기하는거라면 결국 스핀락이 되는거 아닐까? 생각했었다.

만약 다른 redis 클라이언트로 lock을 획득한다면, 대기중인 쓰레드가 lock을 획득하기 위해 레디스에 폴링해야한다. 거기에서 redis 부하와 네트워크 리소스가 소모된다.

하지만 redisson에서 지원해주는 Lock은 대기할 때, 대기 상태 프로세스가 레디스 채널을 구독해서 대기한다.

결론은 '대기 프로세스가 락 점유가 가능한지 확인하는 polling의 네트워크 비용 + 레디스 부하를 줄여준다' 로 이해했다.

&ast; 다만 채널ID 기준으로는 세마포어를 걸고 있어서, 완벽하게 스핀락을 벗어나진 않는 거 같다.

https://incheol-jung.gitbook.io/docs/q-and-a/spring/redisson-trylock


